<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English with Adham Omar - Register</title>
  <meta name="description" content="English with Adham Omar Registration">
  <meta name="keywords" content="English, Adham Omar, Register, English with Adham Omar">
  <meta name="author" content="Adham Omar">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #007BFF;
      --secondary-color: #F4F7FC;
      --accent-color: #FF6B6B;
      --highlight-color: #FFA000;
      --text-color: #333;
      --text-color-light: #555;
      --bg-color: #F4F7FC;
      --white-color: #FFFFFF;
      --border-color: #dee2e6;
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.1);
      --error-bg: #f8d7da;
      --error-text: #721c24;
      --error-border: #f5c6cb;
      --radius-md: 0.5rem;
    }

    /* --- Base & Typography --- */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, .brand-logo {
      font-family: 'Playfair Display', serif;
    }

    /* --- Main Full Page Layout --- */
    .page-container {
      display: flex;
      width: 100vw;
      height: 100vh;
      background: var(--white-color);
      animation: fade-in 0.8s ease-out;
    }

    .welcome-panel {
      flex-basis: 40%;
      background: linear-gradient(45deg, var(--primary-color), #4dabff);
      color: var(--white-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
    }

    .welcome-panel .brand-logo {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .welcome-panel .brand-logo svg {
      width: 32px;
      height: 32px;
    }

    .welcome-panel p {
      font-size: 1.1rem;
      max-width: 350px;
      opacity: 0.9;
      color: var(--white-color);
    }

    .form-panel {
      flex-basis: 60%;
      background-color: var(--white-color);
      padding: clamp(1.5rem, 5vw, 3rem);
      overflow-y: auto;
    }
    
    .form-wrapper {
        max-width: 600px; /* Wider for register form */
        margin: 0 auto;
        width: 100%;
    }

    .form-header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem;
      color: var(--primary-color);
    }

    .form-header p {
      color: var(--text-color-light);
      margin: 0 0 2.5rem;
      font-size: 1.1rem;
    }

    /* --- Form Elements --- */
    .form-section {
      margin-bottom: 2.5rem;
    }

    .form-section h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-color-light);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
      transition: border-color 0.2s, box-shadow 0.2s;
      background-color: var(--white-color);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    .form-group select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236c757d' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1em 1em;
      cursor: pointer;
    }
    
    /* --- UPDATED: Phone Input Container --- */
    .phone-input-container {
        display: flex;
        gap: 0.75rem;
    }
    .phone-input-container input {
        flex: 1;
    }

    .country-code-input {
      flex: 0 0 100px !important;
      text-align: center;
    }

    /* --- UPDATED: Checkbox Alignment --- */
    .non-egyptian-checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: var(--text-color-light);
      cursor: pointer;
    }
    .non-egyptian-checkbox input {
        width: auto;
        margin-right: 0.25rem;
    }

    /* --- UPDATED: File Input Styling --- */
    .file-input-wrapper {
      display: flex;
      align-items: stretch;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      transition: border-color 0.2s, box-shadow 0.2s;
      overflow: hidden; /* Important for border-radius */
    }
    .file-input-wrapper:focus-within {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    .file-input-trigger {
      background-color: var(--secondary-color);
      color: var(--text-color);
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-weight: 500;
      white-space: nowrap;
      transition: background-color 0.2s;
      border-right: 1px solid var(--border-color);
    }
    .file-input-trigger:hover {
      background-color: #e2e6ea;
    }

    .file-input-name {
      flex-grow: 1;
      padding: 0 1rem;
      color: var(--text-color-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      background-color: var(--white-color);
    }

    .form-submit {
      width: 100%;
      padding: 14px 35px;
      border: 2px solid var(--accent-color);
      border-radius: 50px;
      background-color: var(--accent-color);
      color: var(--white-color);
      font-size: 1.1rem;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 1rem;
    }

    .form-submit:hover {
      background-color: var(--white-color);
      color: var(--accent-color);
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }

    .login-link {
      text-align: center;
      margin-top: 1.5rem;
      color: var(--text-color-light);
    }

    .login-link a {
      color: var(--primary-color);
      font-weight: 600;
      text-decoration: none;
    }

    .login-link a:hover {
      text-decoration: underline;
    }

    #form-errors {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--error-bg);
      border: 1px solid var(--error-border);
      color: var(--error-text);
      display: none;
    }

    #form-errors ul { margin: 0; padding-left: 1.2rem; }
    #form-errors li { margin-bottom: 0.25rem; }

    .flash-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      width: auto;
      max-width: 350px;
    }

    .flash-message {
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      border-radius: var(--radius-md);
      color: #fff;
      font-weight: 600;
      box-shadow: var(--shadow-medium);
      animation: flash-slide-in 0.5s ease-out forwards;
      opacity: 0;
    }

    @keyframes flash-slide-in {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }

    .flash-message.fade-out {
      transition: opacity 0.5s ease;
      opacity: 0;
    }

    .flash-success { background: #28a745; }
    .flash-danger, .flash-error { background: var(--accent-color); }
    .flash-info, .flash-warning { background: var(--highlight-color); color: var(--text-color); }

    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* --- Responsive Design --- */
    @media (max-width: 992px) {
      .page-container {
        flex-direction: column;
        height: auto; /* Allow content to scroll on mobile */
      }
      .welcome-panel { display: none; }
      .form-panel { 
          flex-basis: 100%; 
          padding: 2rem;
      }
    }

    @media (max-width: 576px) {
      .form-row { grid-template-columns: 1fr; }
      .form-header h1 { font-size: 2rem; }
    }
  </style>
</head>

<body>
  <div class="flash-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="flash-message flash-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}
  </div>

  <div class="page-container">
    <aside class="welcome-panel">
      <div class="brand-logo">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
        </svg>
        <span> Adham Omar</span>
      </div>
      <p>Unlock your potential in English. Join a community of dedicated learners today.</p>
    </aside>

    <main class="form-panel">
      <div class="form-wrapper">
        <div class="form-header">
            <h1>Create Your Account</h1>
            <p>Welcome! Please fill in the details below to get started.</p>
        </div>

        <form id="registerForm" action="/register" method="POST" enctype="multipart/form-data" novalidate>
            <section class="form-section">
            <h2>Student Information</h2>
            <div class="form-group">
                <label for="student_name">Student Name</label>
                <input type="text" id="student_name" name="student_name" required placeholder="Enter first 4 names" />
            </div>

            <!-- UPDATED HTML STRUCTURE FOR PHONE INPUT -->
            <div class="form-group">
                <label id="student_phone_main_label">Student Phone Number</label>
                <div class="phone-input-container">
                    <input type="tel" id="student_phone_country_code" name="student_phone_country_code" placeholder="e.g., 971" class="country-code-input" style="display: none;" />
                    <input type="tel" id="student_phone" name="student_phone" required placeholder="e.g., 01xxxxxxxxx" />
                </div>
                <label class="non-egyptian-checkbox">
                    <input type="checkbox" id="student_non_egyptian" />
                    <span>Non-Egyptian number</span>
                </label>
            </div>

            <div class="form-group">
                <label for="student_email">Student Email Address</label>
                <input type="email" id="student_email" name="student_email" required placeholder="example@gmail.com" />
            </div>


            <div class="form-group">
                <label for="group">Group</label>
                <select name="group" id="group" required>
                <option value="" disabled selected>Select your group</option>
                {% for group in groups %}<option value="{{ group.id }}">{{ group.name }}</option>{% endfor %}
                </select>
            </div>
            
            <!-- UPDATED: No structural change, but CSS will fix it -->

            </section>

            <section class="form-section">
            <h2>Parent & Account Information</h2>

            <div class="form-group">
                <label for="parent_type">Parent Type</label>
                <select name="parent_type" id="parent_type" required>
                <option value="" disabled selected>Select parent type</option>
                <option value="father">Father</option>
                <option value="mother">Mother</option>
                <option value="guardian">Guardian</option>
                </select>
            </div>
            
            <!-- UPDATED HTML STRUCTURE FOR PHONE INPUT -->
            <div class="form-group">
                 <label id="parent_phone_main_label">Parent Phone Number</label>
                <div class="phone-input-container">
                    <input type="tel" id="parent_phone_country_code" name="parent_phone_country_code" placeholder="e.g., 971" class="country-code-input" style="display: none;" />
                    <input type="tel" id="parent_phone" name="parent_phone" required placeholder="e.g., 01xxxxxxxxx" />
                </div>
                <label class="non-egyptian-checkbox">
                <input type="checkbox" id="parent_non_egyptian" />
                <span>Non-Egyptian number</span>
                </label>
            </div>
            <div class="form-group">
                <label for="password">Password (min. 8 characters)</label>
                <input type="password" id="password" name="password" required placeholder="Create a secure password" />
            </div>
            </section>

            <div id="form-errors"></div>

            <button type="submit" class="form-submit">Create Account</button>
            <div class="login-link">
            Already have an account? <a href="/login">Login now</a>
            </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const flashMessages = document.querySelectorAll('.flash-message');
      flashMessages.forEach(msg => {
        setTimeout(() => {
          msg.classList.add('fade-out');
          msg.addEventListener('transitionend', () => msg.remove());
        }, 5000);
      });

      const fileInput = document.getElementById('profile_picture');
      const fileNameSpan = document.querySelector('.file-input-name');
      if (fileInput && fileNameSpan) {
        fileInput.addEventListener('change', function () {
          if (this.files && this.files.length > 0) {
            fileNameSpan.textContent = this.files[0].name;
          } else {
            fileNameSpan.textContent = 'No file chosen...';
          }
        });
      }
      
      // --- UPDATED JAVASCRIPT LOGIC ---
      
      // --- Student Phone Elements ---
      const studentNonEgyptianCheckbox = document.getElementById('student_non_egyptian');
      const studentCountryCodeInput = document.getElementById('student_phone_country_code');
      const studentPhoneMainLabel = document.getElementById('student_phone_main_label');
      const studentPhoneInput = document.getElementById('student_phone');

      // --- Parent Phone Elements ---
      const parentNonEgyptianCheckbox = document.getElementById('parent_non_egyptian');
      const parentCountryCodeInput = document.getElementById('parent_phone_country_code');
      const parentPhoneMainLabel = document.getElementById('parent_phone_main_label');
      const parentPhoneInput = document.getElementById('parent_phone');

      // --- Student Toggle Logic ---
      studentNonEgyptianCheckbox.addEventListener('change', function () {
        if (this.checked) {
          studentCountryCodeInput.style.display = 'block';
          studentPhoneMainLabel.textContent = 'Country Code & Phone Number';
          studentPhoneInput.placeholder = 'e.g., 1234567890';
          studentCountryCodeInput.value = ''; // Clear any default
        } else {
          studentCountryCodeInput.style.display = 'none';
          studentPhoneMainLabel.textContent = 'Student Phone Number';
          studentPhoneInput.placeholder = 'e.g., 01xxxxxxxxx';
        }
      });

      // --- Parent Toggle Logic ---
      parentNonEgyptianCheckbox.addEventListener('change', function () {
        if (this.checked) {
          parentCountryCodeInput.style.display = 'block';
          parentPhoneMainLabel.textContent = 'Country Code & Phone Number';
          parentPhoneInput.placeholder = 'e.g., 1234567890';
          parentCountryCodeInput.value = ''; // Clear any default
        } else {
          parentCountryCodeInput.style.display = 'none';
          parentPhoneMainLabel.textContent = 'Parent Phone Number';
          parentPhoneInput.placeholder = 'e.g., 01xxxxxxxxx';
        }
      });

      // --- Form Validation (remains mostly the same) ---
      const form = document.getElementById("registerForm");
      const errorContainer = document.getElementById("form-errors");
      const maxFileSize = 5 * 1024 * 1024;

      form.addEventListener("submit", function (e) {
        let messages = [];
        errorContainer.style.display = 'none';
        errorContainer.innerHTML = '';

        const addError = (message) => {
          if (!messages.includes(message)) {
            messages.push(message);
          }
        };

        if (document.getElementById("student_name").value.trim().split(/\s+/).length < 4) {
          addError("Student name must contain at least 4 names.");
        }

        const isStudentNonEgyptian = studentNonEgyptianCheckbox.checked;
        const studentPhoneValue = studentPhoneInput.value.trim();
        if (isStudentNonEgyptian) {
          const studentCountryCode = studentCountryCodeInput.value.trim();
          if (!studentCountryCode || !studentPhoneValue) {
            addError("Please provide both country code and phone number for the student.");
          }
        } else {
          const egyptianPhoneRegex = /^01[0125][0-9]{8}$/;
          if (!egyptianPhoneRegex.test(studentPhoneValue)) {
            addError("Invalid Egyptian student phone number (e.g., 01xxxxxxxxx).");
          }
        }

        const isParentNonEgyptian = parentNonEgyptianCheckbox.checked;
        const parentPhoneValue = parentPhoneInput.value.trim();
        if (isParentNonEgyptian) {
          const parentCountryCode = parentCountryCodeInput.value.trim();
          if (!parentCountryCode || !parentPhoneValue) {
            addError("Please provide both country code and phone number for the parent.");
          }
        } else {
          const egyptianPhoneRegex = /^01[0125][0-9]{8}$/;
          if (!egyptianPhoneRegex.test(parentPhoneValue)) {
            addError("Invalid Egyptian parent phone number (e.g., 01xxxxxxxxx).");
          }
        }

        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!emailRegex.test(document.getElementById("student_email").value.trim())) {
          addError("Invalid student email address.");
        }
        if (document.getElementById("password").value.length < 8) {
          addError("Password must be at least 8 characters long.");
        }
        ["group", "parent_type"].forEach(id => {
          if (document.getElementById(id).value === "") {
            const friendlyName = id.replace("_", " ");
            addError(`Please select a value for ${friendlyName}.`);
          }
        });
        const file = fileInput.files[0];
        if (!file) {
          addError("Please upload a profile picture.");
        } else {
          const allowedTypes = ["image/jpeg", "image/jpg", "image/png"];
          if (!allowedTypes.includes(file.type)) {
            addError("Profile picture must be a JPG or PNG file.");
          }
          if (file.size > maxFileSize) {
            addError("Profile picture size cannot exceed 5MB.");
          }
        }

        if (messages.length > 0) {
          e.preventDefault();
          errorContainer.style.display = 'block';
          const errorList = document.createElement('ul');
          messages.forEach(msg => {
            const listItem = document.createElement('li');
            listItem.textContent = msg;
            errorList.appendChild(listItem);
          });
          errorContainer.appendChild(errorList);
          window.scrollTo(0, errorContainer.offsetTop - 20);
        }
      });
    });
  </script>
</body>

</html>

