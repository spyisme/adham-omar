{% extends "admin/dashboard.html" %}
{% block title %}Edit Assistant Account{% endblock %}
{% block content %}
<div class="edit-assistant-container">
    <div class="edit-assistant-modal-content">
        <h1 class="edit-assistant-title">Edit Assistant Account</h1>
        <a href="{{ url_for('admin.assistants') }}" class="back-link"
            style="display:inline-block; margin-bottom:18px; color:var(--accent); font-weight:500; text-decoration:none; font-size:1rem;">&lt;
            Go back to Assistants Page</a>
        <hr style="border: none; border-top: 1px solid #e3e8f0; margin-bottom: 24px;">

        {% if user.role == 'admin' %}
        <p style="text-align: center; color: var(--muted); margin-top: -16px; margin-bottom: 20px;">Role: Assistant</p>
        {% elif user.role == 'super_admin' %}
        <p style="text-align: center; color: var(--muted); margin-top: -16px; margin-bottom: 20px;">Role: Admin</p>
        {% endif %}

        <form class="edit-assistant-form" method="POST">
            <label for="name" class="edit-label">Name:</label>
            <input type="text" id="name" name="name" value="{{ user.name or '' }}" required class="form-control" />

            <label for="email" class="edit-label">Email:</label>
            <input type="email" id="email" name="email" value="{{ user.email or '' }}" required class="form-control" />

            <label for="phone" class="edit-label">Phone Number:</label>
            <input type="text" id="phone" name="phone_number" value="{{ user.phone_number or '' }}"
                class="form-control" />




            <label class="edit-label">Groups:</label>
            <div class="multi" id="ms-groups">
                <button type="button" class="multi-btn" id="ms-groups-btn">All Groups ▼</button>
                <div class="multi-list" id="ms-groups-list">
                    <label class="multi-all">
                        <input type="checkbox" value="" id="all-groups-checkbox" {% if not user.managed_groups
                            %}checked{% endif %}>
                        All Groups
                    </label>
                    {% for group in groups %}
                    <label>
                        <input type="checkbox" name="group_ids" value="{{ group.id }}" {% if user.managed_groups and
                            group.id in user.managed_groups|map(attribute='id' )|list %}checked{% endif %}>
                        {{ group.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>




            <button type="submit" name="action" value="save" class="btn btn-save">Save Changes</button>
            <button type="submit" name="delete_user" value="1" class="btn btn-delete"
                onclick="return confirm('Are you sure you want to delete this assistant?');">Delete Assistant</button>
        </form>
    </div>
</div>
<style>
    /* Main container */
    .edit-assistant-container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    /* Card-like content styling */
    .edit-assistant-modal-content {
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 8px 32px rgba(44, 62, 80, 0.13);
        padding: 36px 28px 28px 28px;
        max-width: 520px;
        width: 100%;
        color: #222;
        margin: 30px auto 10px auto;
    }

    .edit-assistant-title {
        text-align: center;
        margin-bottom: 1.5rem;
        color: #333;
        /* Darker green for title */
        font-size: 1.6rem;
        font-weight: 700;
    }

    .edit-label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        color: #333;
        /* Darker green for labels */
        font-size: 1rem;
        margin-top: 12px;
    }

    .form-control {
        width: 100%;
        padding: 10px 14px;
        border-radius: 7px;
        border: 1.5px solid #d1d5db;
        background: #f9fafb;
        font-size: 1rem;
        color: #222;
        margin-bottom: 6px;
        outline: none;
        transition: border-color 0.2s, background 0.2s;
        box-sizing: border-box;
    }

    .form-control:focus {
        border-color: #28a745;
        /* Green focus color */
        background: #fff;
    }

    .btn {
        width: 100%;
        font-weight: 600;
        padding: 12px 0;
        font-size: 1.1rem;
        margin-top: 15px;
        color: #fff;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s;
    }

    .btn-save {
        background: #28a745;
        /* Green */
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.1);
    }

    .btn-save:hover {
        background: #218838;
        box-shadow: 0 4px 16px rgba(40, 167, 69, 0.15);
    }

    .btn-delete {
        background: #dc3545;
        /* Red */
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.1);
    }

    .btn-delete:hover {
        background: #c82333;
        box-shadow: 0 4px 16px rgba(220, 53, 69, 0.15);
    }

    .back-link:hover {
        text-decoration: underline;
    }

    /* --- Dropdown Multi-select styles --- */
    .multi {
        position: relative;
    }

    .multi-btn {
        width: 100%;
        padding: 10px 14px;
        border-radius: 7px;
        border: 1.5px solid #d1d5db;
        background: #f9fafb;
        font-size: 1rem;
        text-align: left;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: border-color .2s, background .2s;
    }

    .multi.open .multi-btn,
    .multi-btn:focus {
        border-color: #28a745;
        background: #fff;
        outline: none;
    }

    .multi-list {
        position: absolute;
        top: calc(100% + 6px);
        left: 0;
        right: 0;
        background: #fff;
        border: 1.5px solid #d1d5db;
        border-radius: 7px;
        box-shadow: 0 8px 24px rgba(17, 24, 39, .12);
        max-height: 260px;
        overflow: auto;
        padding: 8px 0;
        display: none;
        z-index: 1001;
    }

    .multi.open .multi-list {
        display: block;
    }

    .multi-list label {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        cursor: pointer;
    }

    .multi-list label:hover {
        background: #f1f5fb;
    }

    .multi-list input[type="checkbox"] {
        accent-color: #28a745;
    }

    .multi-all {
        font-weight: 600;
        color: #28a745;
    }

    /* Responsive styles */
    @media (max-width: 700px) {
        .edit-assistant-modal-content {
            padding: 24px 15px;
            margin-top: 15px;
        }
    }
</style>
<script>
    // --- Dropdown Multi-select logic ---
    function setupDropdown(dropdownId, btnId, listId, labelAll) {
        const dropdown = document.getElementById(dropdownId);
        if (!dropdown) return;
        const btn = document.getElementById(btnId);
        const list = document.getElementById(listId);
        const allCheckbox = list.querySelector('label input[type="checkbox"][value=""]');
        const checkboxes = Array.from(list.querySelectorAll('input[type="checkbox"]')).filter(cb => cb !== allCheckbox);

        // Open/close dropdown
        btn.onclick = function (e) {
            e.stopPropagation();
            document.querySelectorAll('.multi').forEach(d => {
                if (d !== dropdown) d.classList.remove('open');
            });
            dropdown.classList.toggle('open');
        };

        // Close dropdown on outside click
        document.addEventListener('click', function (e) {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('open');
            }
        });

        // All checkbox logic
        if (allCheckbox) {
            allCheckbox.onchange = function () {
                if (allCheckbox.checked) {
                    checkboxes.forEach(cb => cb.checked = false);
                }
                updateBtnLabel();
            };
        }

        // Individual checkbox logic
        checkboxes.forEach(cb => {
            cb.onchange = function () {
                if (cb.checked && allCheckbox) {
                    allCheckbox.checked = false;
                }
                if (!checkboxes.some(c => c.checked) && allCheckbox) {
                    allCheckbox.checked = true;
                }
                updateBtnLabel();
            };
        });

        function updateBtnLabel() {
            let selected = checkboxes.filter(cb => cb.checked).map(cb => cb.parentElement.textContent.trim());
            if (allCheckbox && (allCheckbox.checked || selected.length === 0)) {
                btn.textContent = labelAll + " ▼";
            } else if (selected.length === 1) {
                btn.textContent = selected[0] + " ▼";
            } else if (selected.length > 1) {
                btn.textContent = selected.length + " selected ▼";
            } else if (selected.length === 0 && !allCheckbox) {
                btn.textContent = labelAll + " ▼";
            }
        }
        updateBtnLabel();
    }

    document.addEventListener('DOMContentLoaded', function () {
        setupDropdown('ms-schools', 'ms-schools-btn', 'ms-schools-list', 'All Groups');
        setupDropdown('ms-stages', 'ms-stages-btn', 'ms-stages-list', 'All Stages');
        setupDropdown('ms-groups', 'ms-groups-btn', 'ms-groups-list', 'All Classes');
        setupDropdown('ms-subjects', 'ms-subjects-btn', 'ms-subjects-list', 'All Boards');
    });
</script>
{% endblock %}