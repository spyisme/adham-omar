<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignments - {{ student.name }} - Subjects with Adham Omar</title>
    <link rel="stylesheet" href="/static/css/parent-quiz-design.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!--Button closed-->
    <button id="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15 19l-7-7 7-7" />
        </svg>
    </button>

    <!--Button open-->
    <button id="reopen-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M9 5l7 7-7 7" />
        </svg>
    </button>

    <!-- Sidebar -->
    <nav id="navbar">
        <!-- Close button for mobile -->
        <button id="sidebar-close" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <h3 id="navbartitle">Navigation bar</h3>
        <ul>
            <div id="banner">
                <div class="profile">
                    <div class="avatar">
                        {% if student.name %}
                        {{ student.name.split()[0][0] }}{{ student.name.split()[1][0] if student.name.split()|length > 1
                        else '' }}
                        {% else %}
                        PA
                        {% endif %}
                    </div>
                    <div class="info">
                        <div class="name">Parent Portal</div>
                        <div class="role">{{ student.name }}</div>
                    </div>
                </div>
            </div>
            <li><a href="/parent/dashboard" class="font-main"><img src="/static/images/parent/graduated.png"
                        alt="student icon" width="40px"> Dashboard</a></li>
            <li><a href="/parent/grades" class="font-main"><img src="/static/images/parent/Quizgrades icon.png"
                        alt="Quiz icon" width="40px"> Grades</a></li>
            <li id="quiz"><a href="/parent/assignments" class="font-main"><img
                        src="/static/images/parent/assignment logo.png" alt="Assignment icon" width="40px">
                    Assignments</a></li>
            <li><a href="#" class="font-main" onclick="confirmLogout()"><img src="/static/images/parent/logout.png"
                        alt="Logout icon" width="40px"> Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header -->
        <div id="headerbox">
            <div class="header-row">
                <h1 id="headertitle">Student Assignments</h1>
                <img src="/static/images/parent/Assignment-logo.png" alt="Assignment header icon" width="80px">
            </div>
            <p id="headerdescription">Review your student's assignment history and submissions</p>
        </div>

        <!-- The first 4 boxes of the page -->
        <div id="4-boxes-container">
            <div id="box1">
                <div class="card-logo"><img src="/static/images/parent/assignment logo.png" width="60px"> </div>
                <div class="card-title">Total Assignments</div>
                <div class="card-value">{{ total_count }}</div>
            </div>

            <div id="box2">
                <div class="card-logo"><img src="/static/images/parent/Student-stats-logo.png" width="60px"></div>
                <div class="card-title">Submitted</div>
                <div class="card-value">{{ submitted_count }}</div>
            </div>

            <div id="box3">
                <div class="card-logo"><img src="/static/images/parent/next assignment.png" width="60px"></div>
                <div class="card-title">Pending</div>
                <div class="card-value">{{ pending_count }}</div>
            </div>

            <div id="box4">
                <div class="card-logo"><img src="/static/images/parent/rankicon.png" width="60px"></div>
                <div class="card-title">Completion Rate</div>
                <div class="card-value">
                    {% if total_count > 0 %}
                    {{ ((submitted_count / total_count) * 100)|round(0)|int }}%
                    {% else %}
                    0%
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Assignments table -->
        <section id="quiz-table-card" class="section-card">
            <div class="section-head">
                <h2>Assignment Details</h2>
            </div>

            <div class="table-responsive">
                {% if assignments|length == 0 %}
                <div style="text-align: center; padding: 40px; color: #666;">
                    <p>No assignments available yet.</p>
                </div>
                {% else %}
                <table class="grades-table">
                    <thead>
                        <tr>
                            <th>Assignment</th>
                            <th>Status</th>
                            <th>Deadline</th>
                            <th>Submitted On</th>
                            <th>Grade</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for assignment in assignments %}
                        {% set submission = submissions_dict.get(assignment.id) %}
                        <tr>
                            <td style="font-weight: 600;">{{ assignment.title }}</td>
                            <td>
                                {% if assignment.is_submitted %}
                                <span style="color: #4CAF50; font-weight: bold;">✓ Submitted</span>
                                {% else %}
                                {% if assignment.is_overdue %}
                                <span style="color: #f44336; font-weight: bold;">✗ Overdue</span>
                                {% else %}
                                <span style="color: #ff9800; font-weight: bold;">⏳ Pending</span>
                                {% endif %}
                                {% endif %}
                            </td>
                            <td>
                                <span {% if not assignment.is_submitted and assignment.is_overdue
                                    %}style="color: #f44336; font-weight: bold;" {% endif %}>
                                    {{ assignment.deadline_date.strftime('%Y-%m-%d %I:%M %p') }}
                                </span>
                            </td>
                            <td>
                                {% if submission %}
                                {{ submission.upload_time.strftime('%Y-%m-%d %I:%M %p') }}
                                {% else %}
                                <span style="color: #999;">Not submitted</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if submission and submission.mark %}
                                <span style="color: #2196F3; font-weight: bold;">{{ submission.mark }}</span>
                                {% else %}
                                <span style="color: #999;">Not graded</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if assignment.description %}
                                <button class="read-btn"
                                    onclick="showDescription('{{ assignment.title|replace("'", "\\'") }}', '{{ assignment.description|replace("'", "\\'")|replace("
                                    \n", "\\n" ) }}', '{{ assignment.deadline_date.strftime(' %Y-%m-%d %I:%M %p')
                                    }}')">View Details</button>
                                {% else %}
                                <span style="color: #999;">No description</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </section>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}"
                style="margin-bottom: 10px; padding: 12px 20px; border-radius: 8px; color: white; min-width: 300px; 
                            {% if category == 'success' %}background: #4CAF50;{% elif category == 'error' %}background: #f44336;{% else %}background: #2196F3;{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nav = document.getElementById('navbar');
            const open = document.getElementById('reopen-btn');
            const close = document.getElementById('sidebar-toggle');
            const main = document.querySelector('.main');

            function closeSidebar() {
                nav.classList.add('collapsed');
                main.classList.add('expanded');
                open.style.display = 'block';
                close.style.display = 'none';
            }

            function openSidebar() {
                nav.classList.remove('collapsed');
                main.classList.remove('expanded');
                open.style.display = 'none';
                close.style.display = 'block';
            }

            // Start with sidebar minimized
            closeSidebar();

            close.addEventListener('click', closeSidebar);
            open.addEventListener('click', openSidebar);
        });

        function toggleSidebar() {
            const navbar = document.getElementById('navbar');
            const main = document.querySelector('.main');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const reopenBtn = document.getElementById('reopen-btn');

            if (navbar.classList.contains('collapsed')) {
                navbar.classList.remove('collapsed');
                main.classList.remove('expanded');
                sidebarToggle.style.display = 'block';
                reopenBtn.style.display = 'none';
            } else {
                navbar.classList.add('collapsed');
                main.classList.add('expanded');
                sidebarToggle.style.display = 'none';
                reopenBtn.style.display = 'block';
            }
        }

        document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
        document.getElementById('reopen-btn').addEventListener('click', toggleSidebar);

        // Auto-hide flash messages
        setTimeout(function () {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function (msg) {
                msg.style.opacity = '0';
                msg.style.transition = 'opacity 0.5s ease';
                setTimeout(function () {
                    if (msg.parentNode) {
                        msg.parentNode.removeChild(msg);
                    }
                }, 500);
            });
        }, 3000);

        // Show assignment description popup using SweetAlert
        function showDescription(title, description, deadline) {
            Swal.fire({
                title: 'Assignment Details',
                html: `<div style="text-align: left;">
                    <p><strong>Assignment:</strong> ${title}</p>
                    <p><strong>Deadline:</strong> ${deadline}</p>
                    <hr style="margin: 15px 0;">
                    <p><strong>Description:</strong></p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800; white-space: pre-line; text-align: left;">
                        ${description}
                    </div>
                </div>`,
                icon: 'info',
                confirmButtonText: 'Close',
                confirmButtonColor: '#FF9800',
                width: '600px'
            });
        }

        // SweetAlert logout confirmation
        function confirmLogout() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out of the parent portal.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f44336',
                cancelButtonColor: '#2196F3',
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/parent/logout';
                }
            });
        }
    </script>
</body>

</html>