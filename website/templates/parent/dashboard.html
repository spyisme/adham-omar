<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - {{ student.name }} - Subjects with Adham Omar</title>
    <link rel="stylesheet" href="/static/css/parent-design.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!--Button closed-->
    <button id="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15 19l-7-7 7-7" />
        </svg>
    </button>

    <!--Button open-->
    <button id="reopen-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M9 5l7 7-7 7" />
        </svg>
    </button>

    <!-- Sidebar -->
    <nav id="navbar">
        <!-- Close button for mobile -->
        <button id="sidebar-close" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <h3 id="navbartitle">Navigation bar</h3>
        <ul>
            <div id="banner">
                <div class="profile">
                    <div class="avatar">
                        {% if student.name %}
                        {{ student.name.split()[0][0] }}{{ student.name.split()[1][0] if student.name.split()|length > 1
                        else '' }}
                        {% else %}
                        PA
                        {% endif %}
                    </div>
                    <div class="info">
                        <div class="name">Parent Portal</div>
                        <div class="role">{{ student.name }}</div>
                    </div>
                </div>
            </div>
            <li id="dashboard"><a href="/parent/dashboard" class="font-main"><img
                        src="/static/images/parent/graduated.png" alt="student icon" width="40px"> Dashboard</a></li>
            <li><a href="/parent/grades" class="font-main"><img src="/static/images/parent/Quizgrades icon.png"
                        alt="Quiz icon" width="40px"> Grades</a></li>
            <li><a href="/parent/assignments" class="font-main"><img src="/static/images/parent/assignment logo.png"
                        alt="Assignment icon" width="40px"> Assignments</a></li>
            <li><a href="#" class="font-main" onclick="confirmLogout()"><img src="/static/images/parent/logout.png"
                        alt="Logout icon" width="40px"> Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header -->
        <div id="headerbox">
            <div class="header-row">
                <h1 id="headertitle">Student Dashboard</h1>
                <img src="/static/images/parent/dashboardheader.png" alt="dashboard icon" width="80px">
            </div>
            <p id="headerdescription">Monitor all your student's activities here</p>
        </div>

        <!-- Cards -->
        <div class="dashboard-content">
            <!-- Student Info -->
            <div id="student-information-container">
                <div class="profile-header">
                    <div class="avatar" style="width: 80px; height: 80px; display: flex;">
                        {% if student.profile_picture %}
                        <img src="/static/profile_pictures/{{student.profile_picture}}" alt="Profile Picture"
                            style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                        {% else %}
                        <span
                            style="display: flex; width: 100%; height: 100%; background: #e0e0e0; border-radius: 50%; font-size: 2.5rem; color: #555;">
                            {{ student.name[0]|upper }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="profile-text">
                        <h2 class="username">{{ student.name }}</h2>
                        <p class="role">Student</p>
                    </div>
                </div>
                <div id="student-information-body">
                    <div class="student-information-row">
                        <div class="label">Student Name</div>
                        <div class="value">{{ student.name }}</div>
                    </div>
                    <div class="student-information-row">
                        <div class="label">School</div>
                        <div class="value">{{ student.school.name if student.school else 'Not assigned' }}</div>
                    </div>
                    <div class="student-information-row">
                        <div class="label">Student ID</div>
                        <div class="value">{{ student.code }}</div>
                    </div>
                    <div class="student-information-row">
                        <div class="label">Class</div>
                        <div class="value">{{ student.group.name if student.group else 'Not assigned' }}</div>
                    </div>
                    <div class="student-information-row">
                        <div class="label">Grade</div>
                        <div class="value">{{ student.stage.name if student.stage else 'Not assigned' }}</div>
                    </div>
                    <div class="student-information-row">
                        <div class="label">Subject</div>
                        <div class="value">{{student.subject.name if student.subject else 'Not assigned'}}</div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div id="student-stats-container">

                {% if not student.parent_whatsapp %}
                <div class="stat-row"
                    style="background: #e6f9f0; border: 1px solid #b2e5d6; border-radius: 10px; margin-top: 12px;">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/whatsapp.svg.webp" alt="WhatsApp" class="stat-logo"
                            style="width:32px;height:32px;">
                        <span class="label" style="color: #128C7E;">WhatsApp Updates:</span>
                    </div>
                    <span class="value">
                        <a id="wa-activate-link"
                            href="https://wa.me/+20?text=Student code : {{ student.code }} - (Don't edit this message)"
                            style="color: #128C7E; text-decoration: underline; font-weight: 500;" target="_blank"
                            rel="noopener">
                            Click here to receive WhatsApp notifications
                        </a>
                    </span>
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        var waLink = document.getElementById('wa-activate-link');
                        if (waLink) {
                            waLink.addEventListener('click', function () {
                                setTimeout(function () {
                                    window.location.reload();
                                }, 5000);
                            });
                        }
                    });
                </script>
                {% endif %}

                <div class="stat-row">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/Student-stats-logo.png" alt="Quiz" class="stat-logo">
                        <span class="label">Last Quiz Mark:</span>
                    </div>
                    <span class="value">{{ last_quiz_mark if last_quiz_mark else 'N/A' }}</span>
                </div>
                <div class="stat-row">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/Assignment-logo.png" alt="Assignment" class="stat-logo">
                        <span class="label">Last Assignment:</span>
                    </div>
                    <span class="value">{{ last_assignment_status if last_assignment_status else 'N/A' }}</span>
                </div>
                <div class="stat-row">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/rankicon.png" alt="Rank" class="stat-logo">
                        <span class="label">Total Assignments:</span>
                    </div>
                    <span class="value">{{ total_assignments }}</span>
                </div>
                <div class="stat-row">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/quiz (1).png" alt="Quiz" class="stat-logo">
                        <span class="label">Next Quiz:</span>
                    </div>
                    {% if next_quiz %}
                    <span class="value">{{ next_quiz.quiz_date.strftime('%d %B %Y') }}</span>
                    {% else %}
                    <span class="value">No upcoming quizzes</span>
                    {% endif %}
                </div>
                <div class="stat-row">
                    <div class="label-with-logo">
                        <img src="/static/images/parent/next assignment.png" alt="Next Assignment" class="stat-logo">
                        <span class="label">Pending Assignments:</span>
                    </div>
                    <span class="value">{{ pending_assignments }}</span>
                </div>

            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}"
                style="margin-bottom: 10px; padding: 12px 20px; border-radius: 8px; color: white; min-width: 300px; 
                            {% if category == 'success' %}background: #4CAF50;{% elif category == 'error' %}background: #f44336;{% else %}background: #2196F3;{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nav = document.getElementById('navbar');
            const open = document.getElementById('reopen-btn');
            const close = document.getElementById('sidebar-toggle');
            const main = document.querySelector('.main');

            function closeSidebar() {
                nav.classList.add('collapsed');
                main.classList.add('expanded');
                open.style.display = 'block';
                close.style.display = 'none';
            }

            function openSidebar() {
                nav.classList.remove('collapsed');
                main.classList.remove('expanded');
                open.style.display = 'none';
                close.style.display = 'block';
            }

            // Start with sidebar minimized
            closeSidebar();

            close.addEventListener('click', closeSidebar);
            open.addEventListener('click', openSidebar);
        });

        function toggleSidebar() {
            const navbar = document.getElementById('navbar');
            const main = document.querySelector('.main');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const reopenBtn = document.getElementById('reopen-btn');

            if (navbar.classList.contains('collapsed')) {
                navbar.classList.remove('collapsed');
                main.classList.remove('expanded');
                sidebarToggle.style.display = 'block';
                reopenBtn.style.display = 'none';
            } else {
                navbar.classList.add('collapsed');
                main.classList.add('expanded');
                sidebarToggle.style.display = 'none';
                reopenBtn.style.display = 'block';
            }
        }

        document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
        document.getElementById('reopen-btn').addEventListener('click', toggleSidebar);

        // Auto-hide flash messages
        setTimeout(function () {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function (msg) {
                msg.style.opacity = '0';
                msg.style.transition = 'opacity 0.5s ease';
                setTimeout(function () {
                    if (msg.parentNode) {
                        msg.parentNode.removeChild(msg);
                    }
                }, 500);
            });
        }, 3000);

        // SweetAlert logout confirmation
        function confirmLogout() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out of the parent portal.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f44336',
                cancelButtonColor: '#2196F3',
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/parent/logout';
                }
            });
        }
    </script>
</body>

</html>