<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grades - {{ student.name }} - Subjects with Amr</title>
    <link rel="stylesheet" href="/static/css/parent-quiz-design.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!--Button closed-->
    <button id="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15 19l-7-7 7-7" />
        </svg>
    </button>
    <!--Button open-->
    <button id="reopen-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M9 5l7 7-7 7" />
        </svg>
    </button>
    <!-- Sidebar -->
    <nav id="navbar">
        <button id="sidebar-close" onclick="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <h3 id="navbartitle">Navigation bar</h3>
        <ul>
            <div id="banner">
                <div class="profile">
                    <div class="avatar">
                        {% if student.name %}
                        {{ student.name.split()[0][0] }}{{ student.name.split()[1][0] if student.name.split()|length > 1
                        else '' }}
                        {% else %}
                        PA
                        {% endif %}
                    </div>
                    <div class="info">
                        <div class="name">Parent Portal</div>
                        <div class="role">{{ student.name }}</div>
                    </div>
                </div>
            </div>
            <li><a href="/parent/dashboard" class="font-main"><img src="/static/images/parent/graduated.png"
                        alt="student icon" width="40px"> Dashboard</a></li>
            <li id="quiz"><a href="/parent/grades" class="font-main"><img
                        src="/static/images/parent/Quizgrades icon.png" alt="Quiz icon" width="40px"> Grades</a></li>
            <li><a href="/parent/assignments" class="font-main"><img src="/static/images/parent/assignment logo.png"
                        alt="Assignment icon" width="40px"> Assignments</a></li>
            <li><a href="#" class="font-main" onclick="confirmLogout()"><img src="/static/images/parent/logout.png"
                        alt="Logout icon" width="40px"> Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header -->
        <div id="headerbox">
            <div class="header-row">
                <h1 id="headertitle">Student Exam Grades</h1>
                <img src="/static/images/parent/Quiz-header.png" alt="Quiz header icon" width="80px">
            </div>
            <p id="headerdescription">Review your student's exam history and marks</p>
        </div>
        <!-- The first 4 boxes of the page -->
        <div id="4-boxes-container">
            <div id="box1">
                <div class="card-logo"><img src="/static/images/parent/lastquizmark.png" width="60px"> </div>
                <div class="card-title">Last Exam Mark</div>
                <div class="card-value">{{ last_exam_mark if last_exam_mark else 'N/A' }}</div>
            </div>
            <div id="box2">
                <div class="card-logo"><img src="/static/images/parent/average.png" width="60px"></div>
                <div class="card-title">Average Mark</div>
                <div class="card-value">{{ average_grade }}%</div>
            </div>
            <div id="box3">
                <div class="card-logo"><img src="/static/images/parent/current grade.png" width="60px"></div>
                <div class="card-title">Highest Mark</div>
                <div class="card-value">{{ highest_grade }}%</div>
            </div>
            <div id="box4">
                <div class="card-logo"><img src="/static/images/parent/progress.png" width="60px"></div>
                <div class="card-title">Total Exams</div>
                <div class="card-value">{{ graded_exams_count }}</div>
            </div>
        </div>
        <!-- Exam marks table -->
        <section id="quiz-table-card" class="section-card">
            <div class="section-head">
                <h2>Exam Details</h2>
            </div>
            <div class="table-responsive">
                {% if exam_submissions|length == 0 %}
                <div style="text-align: center; padding: 40px; color: #666;">
                    <p>No exam grades available yet.</p>
                </div>
                {% else %}
                <table class="grades-table">
                    <thead>
                        <tr>
                            <th>Exam</th>
                            <th>Mark</th>

                            <th>Percentage</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in exam_submissions %}
                        <tr>
                            <td>{{ submission.assignment.title if submission.assignment else '-' }}</td>
                            <td>
                                {% if submission.mark %}
                                {{ submission.mark }} / {{ submission.full_mark }}
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>
                                {% if submission.percentage is not none %}
                                {{ submission.percentage }}%
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>
                                {{ submission.status }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </section>
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}"
                style="margin-bottom: 10px; padding: 12px 20px; border-radius: 8px; color: white; min-width: 300px; 
                    {% if category == 'success' %}background: #4CAF50;{% elif category == 'error' %}background: #f44336;{% else %}background: #2196F3;{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
    </main>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nav = document.getElementById('navbar');
            const open = document.getElementById('reopen-btn');
            const close = document.getElementById('sidebar-toggle');
            const main = document.querySelector('.main');
            function closeSidebar() {
                nav.classList.add('collapsed');
                main.classList.add('expanded');
                open.style.display = 'block';
                close.style.display = 'none';
            }
            function openSidebar() {
                nav.classList.remove('collapsed');
                main.classList.remove('expanded');
                open.style.display = 'none';
                close.style.display = 'block';
            }
            closeSidebar();
            close.addEventListener('click', closeSidebar);
            open.addEventListener('click', openSidebar);
        });
        function toggleSidebar() {
            const navbar = document.getElementById('navbar');
            const main = document.querySelector('.main');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const reopenBtn = document.getElementById('reopen-btn');
            if (navbar.classList.contains('collapsed')) {
                navbar.classList.remove('collapsed');
                main.classList.remove('expanded');
                sidebarToggle.style.display = 'block';
                reopenBtn.style.display = 'none';
            } else {
                navbar.classList.add('collapsed');
                main.classList.add('expanded');
                sidebarToggle.style.display = 'none';
                reopenBtn.style.display = 'block';
            }
        }
        document.getElementById('sidebar-toggle').addEventListener('click', toggleSidebar);
        document.getElementById('reopen-btn').addEventListener('click', toggleSidebar);
        // Auto-hide flash messages
        setTimeout(function () {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function (msg) {
                msg.style.opacity = '0';
                msg.style.transition = 'opacity 0.5s ease';
                setTimeout(function () {
                    if (msg.parentNode) {
                        msg.parentNode.removeChild(msg);
                    }
                }, 500);
            });
        }, 3000);
        // SweetAlert logout confirmation
        function confirmLogout() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out of the parent portal.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f44336',
                cancelButtonColor: '#2196F3',
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/parent/logout';
                }
            });
        }
    </script>
</body>

</html>